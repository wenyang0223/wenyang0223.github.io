{{ if .Site.Params.newsletter.enable }}
<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2>{{ .Site.Params.newsletter.title | markdownify }}</h2>
        <p class="text-light px-md-5 py-4 border-left border-right border-primary">
          {{ .Site.Params.newsletter.content | markdownify }}</p>
        <form action="#" class="row justify-content-center">
          <div class="input-group col-md-8">
            <input type="text" class="form-control" placeholder="Your Email Address">
            <div class="input-group-append">
              <button class="input-group-text btn btn-primary">Subscribe</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
{{ end }}


<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-4 col-md-6 mb-4">
        <h4 class="text-primary  mb-3 footer-title">閱讀＆筆記</h4>
        <ul class="list-unstyled footer-list">
          {{ range .Site.Taxonomies.categories }}
          <li class="footer-item"><a class="text-dark" href="{{ .Page.RelPermalink }}">{{ .Page.Title }} <span class="footer-count">({{ .Count }})</span></a></li>
          {{ end }}
        </ul>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <h4 class="text-primary  mb-3 footer-title">個人反思</h4>
        <ul class="list-unstyled footer-list">
          {{ range .Site.Taxonomies.series }}
          <li class="footer-item"><a class="text-dark" href="{{ .Page.RelPermalink }}">{{ .Page.Title }} <span class="footer-count">({{ .Count }})</span></a></li>
          {{ end }}
        </ul>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <h4 class="text-primary  mb-3 footer-title">會所模式</h4>
        <ul class="list-unstyled footer-list">
          {{ range .Site.Taxonomies.clubhouse }}
          <li class="footer-item"><a class="text-dark" href="{{ .Page.RelPermalink }}">{{ .Page.Title }} <span class="footer-count">({{ .Count }})</span></a></li>
          {{ end }}
        </ul>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-lg-4 col-md-6 mb-4">
        <h4 class="text-primary  mb-3 footer-title">主題文章</h4>
        <ul class="list-unstyled footer-list">
          {{ range .Site.Taxonomies.topics }}
          <li class="footer-item"><a class="text-dark" href="{{ .Page.RelPermalink }}">{{ .Page.Title }} <span class="footer-count">({{ .Count }})</span></a></li>
          {{ end }}
        </ul>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <h4 class="text-primary  mb-3 footer-title">精選文章</h4>
        <ul class="list-unstyled footer-list">
          {{ range .Site.Taxonomies.highlights }}
          <li class="footer-item"><a class="text-dark" href="{{ .Page.RelPermalink }}">{{ .Page.Title }} <span class="footer-count">({{ .Count }})</span></a></li>
          {{ end }}
        </ul>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <h4 class="text-primary  mb-3 footer-title">Projects</h4>
        <ul class="list-unstyled footer-list">
          {{ range .Site.Taxonomies.projects }}
          <li class="footer-item"><a class="text-dark" href="{{ .Page.RelPermalink }}">{{ .Page.Title }} <span class="footer-count">({{ .Count }})</span></a></li>
          {{ end }}
        </ul>
      </div>
    </div>


    {{ if .IsHome }}
      {{ if .Site.Data.gallery.enable }}
        {{ with .Site.Data.gallery }}
        <div class="footer-gallery pt-5">
          <div class="container-fluid">
            <div class="text-center mb-4">
              <h4 class="widget-title">My Gallery</h4>
            </div>
            <div class="row no-gutters align-items-center justify-content-center">
              {{ range .gallery }}
                {{- $src := strings.TrimPrefix "/" .image -}}
                {{- $img := resources.Get $src -}}
                
                <div class="col-lg-2 col-md-3 col-sm-4 col-6 px-1 mb-2">
                  {{ if $img }}
                    {{- $webp := $img.Resize "600x webp" -}} {{/* 圖片變大，Resize 也要加大才清晰 */}}
                    <a href="{{ $img.RelPermalink }}" class="venobox" data-gall="footer-gallery">
                      <img class="img-fluid rounded w-100" src="{{ $webp.RelPermalink }}" alt="gallery" style="transition: .3s;">
                    </a>
                  {{ else }}
                    <a href="{{ .image | absURL }}" class="venobox" data-gall="footer-gallery">
                      <img class="img-fluid rounded w-100" src="{{ .image | absURL }}" alt="gallery">
                    </a>
                  {{ end }}
                </div>
              {{ end }}
            </div>
          </div>
        </div>
        {{ end }}
      {{ end }}
    {{ end }}
  
    <div class="text-center my-4">
      <a href="#" 
         onclick="window.scrollTo({top: 0, behavior: 'smooth'});" 
         class="btn-back-custom">
        ▲ 回到頂部
      </a>
    </div>
    
    <div class="container">
      <div class="row">
        <div class="col-12 border-top mt-4 py-4 text-center">
          {{ .Site.Params.copyright | markdownify }}
        </div>
      </div>
    </div>
  </footer>


<style>

  .footer-title {
    font-size: 0.95rem !important;
    font-weight: 400;
    letter-spacing: 0.5px;
  }
  
  .footer-item {
    font-size: 0.75rem !important;
    margin-bottom: 15px; /* 縮小行距讓它更緊湊 */
    font-weight: 300;

  }
  .footer-count {
    font-size: 0.75rem;
    color: rgb(132, 132, 132);
    margin-left: 3px;
  }
  /* 增加列表最小高度，讓下一行標題更整齊（可選） */
  .footer-list {
    min-height: 120px; 
  }
</style>


<script>
  var indexURL = {{ "index.json" | absURL }}
</script>

{{ "<!-- JS Plugins -->" | safeHTML }}
{{ range .Site.Params.plugins.js}}
<script src="{{ .URL | absURL }}"></script>
{{ end }}
{{ "<!-- Main Script -->" | safeHTML }}
{{ $script := resources.Get "js/script.js" | minify}}
<script src="{{ $script.Permalink }}"></script>


<!-- cookie -->
{{ if site.Params.cookies.enable }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires: {{ site.Params.cookies.expire_days }}
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>

<!-- cookie style -->
<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
{{ end }}

{{ partial "back-to-top.html" . }}

<script>
 
const API_BASE = 'https://wenyang-counters-and-likes.vercel.app/api/counter';

function spawnRabbits(container, originX, originY) {
  const count = 30;
  for (let i = 0; i < count; i++) {
    const rabbit = document.createElement('span');
    rabbit.className = 'rabbit';
    const img = document.createElement('img');
img.src = '/images/mao_6.gif';  // ← 換成你的圖片路徑
img.style.width = '2.25rem';
img.style.height = '2.5rem';

rabbit.appendChild(img);

    const angle = (360 / count) * i + (Math.random() * 20 - 10);
    const distance = 400 + Math.random() * 300;
    const initialOffset = 0.12 + Math.random() * 0.08;  // 12%~20%，還是避免擠團
    const rad = (angle * Math.PI) / 180;
    const dx = Math.cos(rad) * distance;
    const dy = Math.sin(rad) * distance;

    rabbit.style.setProperty('--dx', dx + 'px');
    rabbit.style.setProperty('--dy', dy + 'px');
    rabbit.style.left = (originX - 10) + 'px';
    rabbit.style.top  = (originY - 10) + 'px';

// 動畫時間統一拉長，讓遠的兔子飛得到
rabbit.style.animationDuration = '1.8s';  // 全固定 1.8s（或 1.6 + Math.random()*0.5 也行）
rabbit.style.animationDelay    = (Math.random() * 0.01) + 's';  // 0~50ms

    container.appendChild(rabbit);
    setTimeout(() => rabbit.remove(), 6000);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.counters').forEach(container => {
    const slug = container.dataset.slug;
    if (!slug) return;

    const viewsEl = container.querySelector('#views-count');
    const likesEl = container.querySelector('#likes-count');
    const likeBtn = container.querySelector('.like-btn');

    if (!viewsEl || !likesEl || !likeBtn) return;

    fetch(`${API_BASE}?slug=${encodeURIComponent(slug)}`)
      .then(r => r.json())
      .then(data => {
        viewsEl.textContent = data.views;
        likesEl.textContent = data.likes;
      })
      .catch(err => {
        viewsEl.textContent = '—';
        likesEl.textContent = '—';
      });

    likeBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        const res = await fetch(`${API_BASE}?slug=${encodeURIComponent(slug)}&action=like`, {
          method: 'POST',
          mode: 'cors',
          cache: 'no-cache',
          credentials: 'omit'
        });

        if (!res.ok) throw new Error(`POST 失敗，狀態碼 ${res.status}`);

        const data = await res.json();
        likesEl.textContent = data.likes;

        const rect = container.getBoundingClientRect();
        spawnRabbits(container, e.clientX - rect.left, e.clientY - rect.top);

      } catch (err) {
        console.error('[按讚] 錯誤：', err.message);
        alert('按讚失敗：' + (err.message || '未知錯誤'));
      }
    });
  });
});
</script>
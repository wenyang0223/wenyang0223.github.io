<head>
  <meta charset="utf-8">

{{ if .IsHome }}
  <meta http-equiv="refresh" content="0; url=https://wenyang.vercel.app/">
{{ else }}
  <meta http-equiv="refresh" content="0; url=https://wenyang.vercel.app{{ .RelPermalink }}">
{{ end }}

{{ if .IsHome }}
  <link rel="canonical" href="https://wenyang.vercel.app/">
{{ else }}
  <link rel="canonical" href="https://wenyang.vercel.app{{ .RelPermalink }}">
{{ end }}

<!-- Noscript fallback：給沒 JS / 某些爬蟲更好的體驗 -->
<noscript>
  <meta http-equiv="refresh" content="0; url=https://wenyang.vercel.app{{ if not .IsHome }}{{ .RelPermalink }}{{ end }}">
  <meta name="robots" content="noindex"> <!-- 可選：避免舊站被額外索引 -->
  <p style="text-align:center; margin:2em;">
    網站已遷移到 <a href="https://wenyang.vercel.app">https://wenyang.vercel.app</a>，<br>
    正在自動跳轉… 若未自動跳轉，請點擊上方連結。
  </p>
</noscript>


  <title>
    {{ if .IsHome }}
      {{ .Site.Title }}
    {{ else }}
      {{ .Title }} | {{ .Site.Title }}
    {{ end }}
  </title>
  
    <!-- ✨ 加在這裡：告訴 Pagefind 使用純標題 -->
    <meta data-pagefind-meta="title" content="{{ .Title }}">

  {{ if .Params.ai_keywords }}
  <meta data-pagefind-filter="keywords" content="{{ delimit .Params.ai_keywords ", " }}">
{{ end }}

  {{ "" | safeHTML }}
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  {{ "" | safeHTML }}
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}">
  {{ with .Site.Params.author }}<meta name="author" content="{{ . }}">{{ end }}
  {{ hugo.Generator }}

  <link rel="sitemap" type="application/xml" title="Sitemap" href="{{ .Site.BaseURL }}sitemap.xml">
  
  {{ "" | safeHTML }}
  {{ range .Site.Params.plugins.css }}
  <link rel="stylesheet" href="{{ .URL | absURL }} ">
  {{ end }}

  {{ "" | safeHTML }}
  {{ $styles := resources.Get "scss/style.scss" | toCSS | minify }}
  <link rel="stylesheet" href="{{ $styles.Permalink }}" media="screen">

  {{ "" | safeHTML }}
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.png" type="image/png">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P9L49HVNL4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-P9L49HVNL4');
  </script>

  {{ "" | safeHTML }}
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .content, .content *, .post-meta, .post-meta * {
      font-family: 'Open Sans', 'Noto Sans TC', sans-serif !important;
    }
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Open Sans', 'Noto Sans TC', sans-serif !important;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
  

{{ with .Params.image }}
  {{ $img := resources.Get . }}
  {{ with $img }}
    <img 
      src="{{ .RelPermalink }}" 
      alt="{{ $.Title | plainify }}" 
      data-pagefind-meta="image[src], image_alt[alt]"
      style="display:none;"
    >
  {{ end }}

{{ else }}
  {{ $firstImage := findRE `<img.*?src=["'](.*?)["'].*?>` .Content 1 }}
  {{ with index $firstImage 0 }}
    {{ $src := replaceRE `.*src=["'](.*?)["'].*` `$1` . }}
    <img 
      src="{{ $src | safeURL }}" 
      data-pagefind-meta="image[src]"
      style="display:none;"
    >
  {{ end }}
{{ end }}

{{ partial "pagefind-metadata.html" . }}

<style>
  a {
    color: rgba(111, 202, 209, 82);
  }
  a[href^="mailto:"] {
  color: #45afb7da;
  font-weight: bold;
}
</style>

</head>
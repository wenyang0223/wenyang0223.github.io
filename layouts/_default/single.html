{{ define "main" }}
<section class="section-sm">
  <div class="container pl-1 pr-4">
    <div class="row">
      <div class="col-lg-10 mx-auto">
        
        <nav class="post-nav-wrapper">
          {{ if .PrevInSection }}
            <a class="nav-item prev" href="{{ .PrevInSection.Permalink }}">
              <span class="nav-label">ğŸ‘ˆä¸Šä¸€ç¯‡</span>
              <span class="nav-title">{{ .PrevInSection.Title }}</span>
            </a>
          {{ else }}
            <div class="nav-item spacer"></div> {{ end }}
        
          {{ if .NextInSection }}
            <a class="nav-item next" href="{{ .NextInSection.Permalink }}">
              <span class="nav-label">ä¸‹ä¸€ç¯‡ğŸ‘‰</span>
              <span class="nav-title">{{ .NextInSection.Title }}</span>
            </a>
          {{ end }}
        </nav>

        <div class="mb-4 d-flex justify-content-between align-items-center">
          <a href="/" onclick="if(document.referrer) { window.history.back(); return false; }" class="btn-back-custom">
            â† è¿”å›ä¸Šä¸€é 
          </a>
          
          <a href="javascript:void(0)" onclick="window.scrollTo({top: document.querySelector('.content').offsetTop + document.querySelector('.content').offsetHeight, behavior: 'smooth'});" class="btn-back-custom">
            â–¼ è·³è‡³åº•éƒ¨
          </a>
        </div>

        <div class="post-meta mb-2">
          {{ $taxonomies := slice "categories" "clubhouse" "topics" "series" "highlights" "projects" }}
          {{ $isFirst := true }}
          {{ range $tax := $taxonomies }}
            {{ with $.GetTerms $tax }}
              {{ range . }}
                {{ if not $isFirst }}<span class="mx-1 text-muted">|</span>{{ end }}
                <a href="{{ .Permalink }}" class="text-primary font-weight-bold">
                  {{ .LinkTitle }}
                </a>
                {{ $isFirst = false }}
              {{ end }}
            {{ end }}
          {{ end }}
        </div>

        <h2>{{ .Title | markdownify }}</h2>
        
        <div class="mb-3 text-center">
          <span>By {{if .Params.Author}}{{ .Params.Author }}{{else}}{{.Site.Params.Author}}{{end}}</span>
          {{ if not .Params.HideDate }}
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>{{ .PublishDate.Format "02 January 2006" }}</span>
          {{ end }}
        </div>

        {{ if .Params.image }}
        {{/* 1. å–å¾—è·¯å¾‘ä¸¦ä¿®å¾©ï¼šå»é™¤é–‹é ­æ–œç·š */}}
        {{- $src := strings.TrimPrefix "/" .Params.image -}}
        {{- $img := resources.Get $src -}}
      
        <div class="post-featured-image mb-4">
          {{ if $img }}
            {{/* 2. æˆåŠŸï¼šåŸ·è¡Œ WebP è½‰æª” */}}
            {{- $webp := $img.Resize (printf "%dx%d webp" $img.Width $img.Height) -}}
            <picture>
              <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
              <img src="{{ $img.RelPermalink }}" 
              class="img-fluid" 
              style="width: auto; max-width: 80%; height: auto; border-radius: 8px; display: block; margin: 0 auto;" 
              alt="{{ .Title }}">
            </picture>
          {{ else }}
            {{/* 3. å¤±æ•—ï¼šé¡¯ç¤ºåŸå§‹è·¯å¾‘ï¼ˆä¿è­‰ä¸ç ´åœ–ï¼‰ */}}
            <img src="{{ .Params.image | absURL }}" 
                 class="img-fluid w-100" 
                 style="height: 450px; object-fit: cover; border-radius: 8px;" 
                 alt="{{ .Title }}">
          {{ end }}
        </div>
      {{ end }}
        
        <div class="content mb-5">
          {{ .Content }}
        </div>

        <hr id="article-end" style="margin-top: 1px;">

        <div style="margin: 1.2rem 0; font-size: 0.95em; color: #666;">
          <div>ğŸ‘€ æœ¬é ç€è¦½é‡ï¼š <span class="waline-pageview-count"></span> æ¬¡</div>
          
          <div style="margin-top: 0.8rem;">ğŸ  ä¸»é ç€è¦½é‡ï¼š <span class="waline-pageview-count" data-path="/"></span> æ¬¡</div>
        </div>

        <div class="mt-4 mb-1 d-flex justify-content-between align-items-center">
          <a href="/" onclick="if(document.referrer) { window.history.back(); return false; }" class="btn-back-custom">
            â† è¿”å›ä¸Šä¸€é 
          </a>
        
          <a href="javascript:void(0)" onclick="window.scrollTo({top: 0, behavior: 'smooth'});" class="btn-back-custom">
            â–² å›åˆ°é ‚éƒ¨
          </a>
        </div>
        
        <nav class="post-nav-wrapper">
          {{ if .PrevInSection }}
            <a class="nav-item prev" href="{{ .PrevInSection.Permalink }}">
              <span class="nav-label">ğŸ‘ˆä¸Šä¸€ç¯‡</span>
              <span class="nav-title">{{ .PrevInSection.Title }}</span>
            </a>
          {{ else }}
            <div class="nav-item spacer"></div> {{ end }}
        
          {{ if .NextInSection }}
            <a class="nav-item next" href="{{ .NextInSection.Permalink }}">
              <span class="nav-label">ä¸‹ä¸€ç¯‡ğŸ‘‰</span>
              <span class="nav-title">{{ .NextInSection.Title }}</span>
            </a>
          {{ end }}
        </nav>

        <style>
          /* è¿™é‡Œçš„å˜é‡ä¼šè¦†ç›– Waline çš„é»˜è®¤æ ·å¼ */
          :root {
            --waline-theme-color: $primary-color;     /* æ¯”å¦‚æ”¹ä¸ºå’Œä½ ç½‘ç«™é£æ ¼ä¸€è‡´çš„æ£•è‰² */
            --waline-active-color: #dc0000;    /* æ¿€æ´»çŠ¶æ€çš„é¢œè‰² */
            --waline-badge-radius: 4px;        /* å¾½ç« åœ†è§’ */
            --waline-border-radius: 8px;       /* æ•´ä½“åœ†è§’ */
          }
        </style>

      </div> <div class="col-lg-10 mx-auto">
        <div id="waline" style="margin-top: 1rem;"></div>
      <script type="module">
        import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
        init({
          el: '#waline',
          serverURL: 'https://wenyang-waline.vercel.app',
          dark: 'auto',
          path: window.location.pathname.replace(/\/$/, ''),
          pageview: true,
          reaction: false,
          site: {
            name: 'è†è½çš„æ²³æµï½œé–±è®€ãƒ»æ›¸å¯«ãƒ»å¿ƒç†ãƒ»é›»å½±', 
            url: 'https://wenyang.vercel.app'
          }
        });
      </script>
    </div>
  </div>
</section>

<style>
  .btn-back-custom {
    display: inline-block;
    padding: 8px 20px;
    background-color: transparent;
    color: #2d3133;
    border: 1px solid #ced4da;
    border-radius: 5px;
    text-decoration: none;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  .btn-back-custom:hover {
    background-color: #f8f9fa;
    color: $primary-color ;
    border-color: $primary-color;
    text-decoration: none;
  }
</style>

<style>
  /* è®“æ»¾å‹•è®Šå¾—æ»‘é † */
  html { 
    scroll-behavior: smooth; 
  }

  /* æ¨™é¡Œå„ªåŒ–ï¼šé©åˆé•·æ¨™é¡Œ */
  .post-title {
    line-height: 1.4;
    margin-bottom: 20px;
    font-weight: 700;
  }

  /* çµ±ä¸€æŒ‰éˆ•æ¨£å¼ */
  .btn-back-custom {
    display: inline-flex;
    align-items: center;
    padding: 7px 18px;
    background-color: transparent;
    color: #6c757d;
    border: 1px solid #ced4da;
    border-radius: 4px;
    text-decoration: none !important;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .btn-back-custom:hover {
    background-color: #f8f9fa;
    color: $primary-color;
    border-color: $primary-color;
  }

  /* Flex æ’ç‰ˆè¼”åŠ© */
  .d-flex { display: flex !important; }
  .justify-content-between { justify-content: space-between !important; }
  .align-items-center { align-items: center !important; }
</style>

<style>
  .post-nav-wrapper {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    padding: 15px 0;

  }
  .nav-item {
    max-width: 20%;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
  }
  .next { text-align: right; }
  .nav-label { font-size: 1em; color: rgb(100, 100, 100); }
  .nav-title { font-weight:600; 
  margin-top: 8px;
  line-height: 1.8;      /* èª¿æ•´è¡Œè·ï¼Œæ›è¡Œæ™‚æ‰ä¸æœƒå¤ªæ“  */

  /* æ ¸å¿ƒï¼šé™åˆ¶æœ€å¤šé¡¯ç¤ºå…©è¡Œ */
  display: -webkit-box;
  -webkit-line-clamp: 2;   /* é€™è£¡è¨­å®šã€Œ2ã€ä»£è¡¨æœ€å¤šé¡¯ç¤ºå…©è¡Œ */
  -webkit-box-orient: vertical;

  /* è™•ç†æº¢å‡º */
  overflow: hidden;        /* è¶…éå…©è¡Œçš„éƒ¨åˆ†éš±è— */
  text-overflow: ellipsis; /* åœ¨ç¬¬äºŒè¡Œæœ«å°¾é¡¯ç¤º ... */
  overflow-wrap: break-word;
  }
</style>

{{ end }}
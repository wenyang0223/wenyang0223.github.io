{{ define "main" }}

<!-- blog post -->
<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mb-5 mb-lg-0">
        <div class="row">
          {{ $paginator := .Paginate .Data.Pages }}
          {{ range $paginator.Pages }}
          {{ .Render "post" }}
          {{ end }}
        </div>
      </div>
      <!-- sidebar -->
      {{ partial "sidebar.html" . }}
      <!-- /sidebar -->

      <!-- pagination -->
      <div class="col-12 mt-5">
        {{ template "_internal/pagination.html" . }}
      </div>
    </div>
  </div>
</section>
<!-- /blog post -->
<!-- Waline ç€è¦½é‡åˆå§‹åŒ– -->

<script type="module">
  import { pageviewCount } from 'https://unpkg.com/@waline/client@v3/dist/pageview.js';

  pageviewCount({
    serverURL: 'https://wenyang-waline.vercel.app',
    path: '/',  // æ˜ç¢ºæŒ‡å®šä¸»é è·¯å¾‘
    update: true
  });
</script>

<!-- è‡¨æ™‚åˆ·ç€è¦½é‡è…³æœ¬ -->
<script>
  (function() {
    // æª¢æŸ¥æ˜¯å¦åœ¨åˆ·ç€è¦½é‡æ¨¡å¼
    const urlParams = new URLSearchParams(window.location.search);
    const autoRefresh = urlParams.get('auto');
    
    if (autoRefresh === 'true') {
      // å¾ localStorage è®€å–è¨ˆæ•¸
      let count = parseInt(localStorage.getItem('pvCount') || '0');
      const target = 100;
      
      if (count < target) {
        count++;
        localStorage.setItem('pvCount', count.toString());
        
        // åœ¨é é¢ä¸Šé¡¯ç¤ºé€²åº¦
        document.body.insertAdjacentHTML('beforeend', `
          <div style="position: fixed; top: 20px; right: 20px; 
                      background: #000; color: #fff; padding: 20px; 
                      border-radius: 10px; z-index: 9999; font-size: 20px;">
            ğŸ”„ åˆ·æ–°ä¸­...<br>
            é€²åº¦: ${count}/${target}<br>
            <span style="font-size: 14px;">è«‹å‹¿é—œé–‰æ­¤é é¢</span>
          </div>
        `);
        
        console.log(`âœ… ç¬¬ ${count}/${target} æ¬¡`);
        
        // 3 ç§’å¾Œé‡æ–°è¼‰å…¥
        setTimeout(() => {
          location.reload();
        }, 3000);
        
      } else {
        // å®Œæˆäº†
        localStorage.removeItem('pvCount');
        document.body.insertAdjacentHTML('beforeend', `
          <div style="position: fixed; top: 50%; left: 50%; 
                      transform: translate(-50%, -50%);
                      background: #4CAF50; color: #fff; padding: 40px; 
                      border-radius: 20px; z-index: 9999; font-size: 30px;
                      text-align: center;">
            ğŸ‰ å®Œæˆ 100 æ¬¡ï¼<br>
            <button onclick="window.location.href='/'" 
                    style="margin-top: 20px; padding: 10px 20px; 
                           font-size: 18px; cursor: pointer;">
              è¿”å›æ­£å¸¸æ¨¡å¼
            </button>
          </div>
        `);
        
        // æŸ¥çœ‹çµæœ
        fetch('https://wenyang-waline.vercel.app/api/article?path=/')
          .then(res => res.json())
          .then(data => {
            console.log('ğŸ‰ æœ€çµ‚ç€è¦½é‡:', data.data[0]?.pageview);
            alert('æœ€çµ‚ç€è¦½é‡: ' + (data.data[0]?.pageview || 0));
          });
      }
    }
  })();
  </script>
  
  <!-- åŸæœ¬çš„ Waline è¨ˆæ•¸è…³æœ¬ -->
  <script type="module">
    import { pageviewCount } from 'https://unpkg.com/@waline/client@v3/dist/pageview.js';
  
    pageviewCount({
      serverURL: 'https://wenyang-waline.vercel.app',
      path: '/',
      update: true
    });
  </script>

{{ end }}

